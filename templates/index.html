{% extends "base.html" %}

{% block content %}
<div class="row mb-4 g-4">
    <div class="col-md-3">
        <div class="card dashboard-card animate__animated animate__fadeInUp" data-delay="100">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3 text-danger">
                    <i class="bi bi-person-plus-fill"></i>
                </div>
                <h5>Добавить учащегося</h5>
                <p class="small text-muted">Новая регистрация в системе</p>
                <a href="/post" class="btn btn-danger btn-sm stretched-link">Перейти</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card dashboard-card animate__animated animate__fadeInUp" data-delay="200">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3 text-danger">
                    <i class="bi bi-people-fill"></i>
                </div>
                <h5>Список учащихся</h5>
                <p class="small text-muted">Все зарегистрированные ученики</p>
                <a href="/students" class="btn btn-danger btn-sm stretched-link">Перейти</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card dashboard-card animate__animated animate__fadeInUp" data-delay="300">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3 text-danger">
                    <i class="bi bi-search"></i>
                </div>
                <h5>Поиск</h5>
                <p class="small text-muted">Поиск по базе данных</p>
                <a href="#search" class="btn btn-danger btn-sm stretched-link">Перейти</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card dashboard-card animate__animated animate__fadeInUp" data-delay="400">
            <div class="card-body text-center p-4">
                <div class="card-icon mb-3 text-danger">
                    <i class="bi bi-file-earmark-excel-fill"></i>
                </div>
                <h5>Экспорт</h5>
                <p class="small text-muted">Экспорт данных в Excel</p>
                <a href="#export" class="btn btn-danger btn-sm stretched-link">Перейти</a>
            </div>
        </div>
    </div>
</div>

<!-- Отчеты -->
<div id="reports" class="mb-5">
    <h3 class="mb-4 animate__animated animate__fadeIn">
        <i class="bi bi-file-earmark-bar-graph-fill me-2 text-danger"></i>Формирование отчетов
    </h3>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card report-card animate__animated animate__fadeInLeft h-100">
                <div class="card-body">
                    <h5><i class="bi bi-bookmarks-fill me-2 text-danger"></i>Отчет по направлениям</h5>
                    <p class="text-muted">Сформируйте отчет по выбранному направлению обучения</p>
                    <form class="report-form">
                        <div class="mb-3">
                            <label class="form-label">Направление:</label>
                            <select class="form-select">
                                <option>Все направления</option>
                                <option>Программирование на Python</option>
                                -->
                                <option>Робототехника</option>
                                <option>3D моделирование</option>
                                <option>Системное администрирование</option>
                                <option>Мобильная разработка</option>
                                <option>VR/AR разработка</option>
                                <option>Машинное обучение</option>
                                <option>Создание сайтов</option>
                                <option>Основы логики и алгоритмики</option>
                                <option>Компьютерная грамотность</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-download me-1"></i> Сформировать
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card report-card animate__animated animate__fadeInRight h-100">
                <div class="card-body">
                    <h5><i class="bi bi-people-fill me-2 text-danger"></i>Отчет по возрасту</h5>
                    <p class="text-muted">Сформируйте отчет по возрастным группам</p>
                    <form class="report-form">
                        <div class="mb-3">
                            <label class="form-label">Возрастная группа:</label>
                            <select class="form-select">
                                <option>Все возрасты</option>
                                <option>7-9 лет</option>
                                <option>10-12 лет</option>
                                <option>13-15 лет</option>
                                <option>16-18 лет</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-download me-1"></i> Сформировать
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card report-card animate__animated animate__fadeInLeft h-100">
                <div class="card-body">
                    <h5><i class="bi bi-building me-2 text-danger"></i>Отчет по школам</h5>
                    <p class="text-muted">Сформируйте отчет по учащимся из школ</p>
                    <form class="report-form" id="school-report-form">
                        <div class="mb-3">
                            <label class="form-label">Регион:</label>
                            <select class="form-select" id="report-region" required>
                                <option value="">Выберите регион</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Город:</label>
                            <select class="form-select" id="report-city" disabled required>
                                <option value="">Сначала выберите регион</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Школа:</label>
                            <select class="form-select" id="report-school" disabled required>
                                <option value="">Сначала выберите город</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger" id="report-school-button" disabled>
                            <i class="bi bi-download me-1"></i> Сформировать
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card report-card animate__animated animate__fadeInRight h-100">
                <div class="card-body">
                    <h5><i class="bi bi-gender-ambiguous me-2 text-danger"></i>Отчет по полу</h5>
                    <p class="text-muted">Сформируйте отчет по полу учащихся</p>
                    <form class="report-form">
                        <div class="mb-3">
                            <label class="form-label">Пол:</label>
                            <select class="form-select">
                                <option>Все</option>
                                <option>Мужской</option>
                                <option>Женский</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-download me-1"></i> Сформировать
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const reportRegion = document.getElementById('report-region');
    const reportCity = document.getElementById('report-city');
    const reportSchool = document.getElementById('report-school');
    const reportButton = document.getElementById('report-school-button');
    const reportForm = document.getElementById('school-report-form');

    fetch('/api/regions')
        .then(response => response.json())
        .then(regions => {
            regions.forEach(region => {
                reportRegion.innerHTML += `<option value="${region.id}">${region.title}</option>`;
            });


            const rsoOption = Array.from(reportRegion.options).find(opt =>
                opt.text.includes('Республика Северная Осетия — Алания')
            );
            if (rsoOption) {
                rsoOption.selected = true;
                reportRegion.dispatchEvent(new Event('change'));
            }
        });

    //меняем регион
    reportRegion.addEventListener('change', function() {
        const regionId = this.value;
        reportCity.disabled = !regionId;
        reportSchool.disabled = true;
        reportButton.disabled = true;
        reportCity.innerHTML = '<option value="">Выберите город</option>';
        reportSchool.innerHTML = '<option value="">Сначала выберите город</option>';

        if (regionId) {
            fetch(`/api/cities/${regionId}`)
                .then(response => response.json())
                .then(cities => {
                    cities.forEach(city => {
                        reportCity.innerHTML += `<option value="${city.id}">${city.title}</option>`;
                    });
                });
        }
    });

    //меняем город
    reportCity.addEventListener('change', function() {
        const cityId = this.value;
        reportSchool.disabled = !cityId;
        reportButton.disabled = true;
        reportSchool.innerHTML = '<option value="">Выберите школу</option>';

        if (cityId) {
            fetch(`/api/schools/${cityId}`)
                .then(response => response.json())
                .then(schools => {
                    schools.forEach(school => {
                        reportSchool.innerHTML += `<option value="${school.id}">${school.title}</option>`;
                    });
                });
        }
    });

    //кнопка активна/неактиванн
    reportSchool.addEventListener('change', function() {
        reportButton.disabled = !this.value;
    });

    //отправка формы отчетв
    reportForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const region = reportRegion.options[reportRegion.selectedIndex].text;
        const city = reportCity.options[reportCity.selectedIndex].text;
        const school = reportSchool.options[reportSchool.selectedIndex].text;

        alert(`Будет сформирован отчет по:\nРегион: ${region}\nГород: ${city}\nШкола: ${school}`);
    });
});
</script>
{% endblock %}